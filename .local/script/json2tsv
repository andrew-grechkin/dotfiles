#!/usr/bin/env -S jq -r --from-file

# convert JSON array of hashes to TSV with header based on keys

if length == 0 then halt end

| (
    .[0]
    | keys_unsorted
    | @tsv
), (
    {"array": 1, "object": 1} as $to_encode
    | .[]
    | [.[]]
    | map(if type | in($to_encode) then @json else . end)
    | @tsv
)
