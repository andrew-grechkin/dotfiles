#!/usr/bin/env bash

set -Eeuo pipefail

[[ -n "${GPG_RECIPIENTS:-}" ]] || { echo 'unknown recipients' >&2; exit 1; }

IFS=',' read -r -a recipients <<< "$GPG_RECIPIENTS"

for FILE in "$@"; do
    FILENAMEFULL=$(basename "$FILE")
    gpg --armor --encrypt --default-recipient-self "${recipients[@]/#/'--recipient='}" --output "./${FILENAMEFULL}.gpg" "$FILE"
done
